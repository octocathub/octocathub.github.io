(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{578:function(t,s,a){"use strict";a.r(s);var e=a(13),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"linux防止ssh暴力破解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux防止ssh暴力破解"}},[t._v("#")]),t._v(" Linux防止ssh暴力破解")]),t._v(" "),a("p",[t._v("每次登录系统(CentOS7)，就会发现有N次登陆失败的统计信息。\n查看 /var/log/secure 日志文件可以看到文件中有很多认证失败的ip登录信息，这就说明已经被无数不同的IP地址和不同的用户进行SSH尝试连接了。\n所以可能会遇到暴力破解。也就是不断地通过字典来进行暴力破解。")]),t._v(" "),a("p",[t._v("以下几种防范方法：")]),t._v(" "),a("h2",{attrs:{id:"禁止root登陆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#禁止root登陆"}},[t._v("#")]),t._v(" 禁止root登陆")]),t._v(" "),a("p",[t._v("其实这里也就是禁止默认用户登陆。因为root在Linux\n利属于默认账户，所以破解的时候也一定会选择这个默认的账户进行暴力破解的。")]),t._v(" "),a("p",[t._v("修改sshd服务器端的配置文件 /etc/ssh/sshd_config")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vps ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/ssh/sshd_config\n\nPermitRootLogin no  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置该选项")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vps ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" sshd restart "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启 ssh服务")]),t._v("\n")])])]),a("h2",{attrs:{id:"修改-ssh-默认端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-ssh-默认端口"}},[t._v("#")]),t._v(" 修改 SSH 默认端口")]),t._v(" "),a("p",[t._v("修改SSH默认端口号，sshd服务器端的配置文件为"),a("code",[t._v("/etc/ssh_config")]),t._v(" 。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vps ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/ssh/sshd_config\n\nPort "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2280")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置ssh的端口号")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vps ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ systemctl restart sshd "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启SSH")]),t._v("\n")])])]),a("p",[t._v("查看状态")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vps ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ systemctl status sshd\n")])])]),a("p",[t._v("查看端口是否更改")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vps ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" -ntlp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2280")]),t._v("\ntcp    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:2280   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:*   LISTEN   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8793")]),t._v("/sshd          \ntcp6   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" :::2280        :::*        LISTEN   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8793")]),t._v("/sshd\n")])])]),a("h2",{attrs:{id:"根据secure文件中失败的ip次数做限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#根据secure文件中失败的ip次数做限制"}},[t._v("#")]),t._v(" 根据secure文件中失败的ip次数做限制")]),t._v(" "),a("p",[t._v("当同一个IP地址超过5次的尝试，那么就加入/etc/hosts.deny 。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#! /bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 提取所有的IP到black.list文件中")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /var/log/secure"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/Failed/{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("NF-3"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uniq")]),t._v(" -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v('"="'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(";}'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /usr/local/bin/black.list\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设定次数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("define")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[t._v("i")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v("  /usr/local/bin/black.list"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" $i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" -F"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v("}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NUM")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" $i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" -F"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v("}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$NUM")]),t._v(" -gt "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$define")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$IP")]),t._v(" /etc/hosts.deny "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/null\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$?")]),t._v(" -gt "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sshd:'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$IP")]),t._v(':deny"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" /etc/hosts.deny\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n")])])]),a("p",[t._v("添加计划任务")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vps ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("crontab")]),t._v(" -e\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每3分钟检查一次")]),t._v("\n*/3 * * * *  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" /usr/local/bin/secure_ssh.sh\n")])])]),a("p",[t._v("重启 crontab")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@vps ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ systemctl restart crond\n")])])]),a("h2",{attrs:{id:"附录-sshd常用配置参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附录-sshd常用配置参数"}},[t._v("#")]),t._v(" 附录---sshd常用配置参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("参数")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("port")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("监听端口号")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ListenAddress ip")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("监听的IP地址")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("LoginGraceTime")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("发起连接后多少时间内必须登录超时断开连接")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("PermitRootLogin")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("是否允许root登录")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("StrictModes")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("检查.ssh/文件的所有者，权限等")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("MaxAuthTries")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("最大密码尝试次数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("MaxSessions")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("同一连接的最大绘会话数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("PubkeyAuthentication")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("基于Key验证")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("PermitEmptyPasswords")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("是否使用空口令登录")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("PasswordAuthentication")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("基于口令验证")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("GatewayPorts")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("ssh服务监听所使用的端口当网关使用")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ClientAliveInterval")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("间隔多久客户端和服务器端没有操作就断开连接")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ClientAliveCountMax")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("和上面那项一起使用为检查的次数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("UseDNS")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("是否使用名称解析")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("GSSAPIAuthentication")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("GSSAPI的认证")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("MaxStartups")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("未验证的最大连接数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("Banner")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("登录前提示")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("AllowUsers")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("允许哪些用户登录（白名单）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("DenyUsers")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("不允许哪些用户登录（黑名单）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("AllowGroups")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("允许哪些组登录（白名单）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("DenyGroups")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("不允许哪些组登录（黑名单）")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);