(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{609:function(t,e,s){"use strict";s.r(e);var a=s(13),_=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"sql-mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sql-mode"}},[t._v("#")]),t._v(" sql-mode")]),t._v(" "),s("p",[t._v("sql_mode是一组语法校验规则。\nMySQL服务器能够工作在不同的SQL模式下，并能针对不同的客户端以不同的方式应用这些模式。这样，应用程序就能对服务器操作进行量身定制以满足自己的需求。这类模式定义了MySQL应支持的SQL语法，以及应该在数据上执行何种确认检查。这样，就能在众多不同的环境下、与其他数据库服务器一起更容易地使用MySQL。可以使用“--sql-mode=\"modes\"”选项，通过启动mysqld来设置默认的SQL模式。从MySQL 4.1开始，也能在启动之后，使用SET [SESSION|GLOBAL] sql_mode='modes'语句，通过设置sql_mode变量更改模式。")]),t._v(" "),s("p",[t._v("通常在linux下安装完mysql后，默认的sql-mode值是空，在这种情形下mysql执行的是一种不严格的检查，例如日期字段可以插入’0000-00-00 00:00:00’这样的值，还有如果要插入的字段长度超过列定义的长度，那么mysql不会终止操作，而是会自动截断后面的字符继续插入操作。")]),t._v(" "),s("h2",{attrs:{id:"应用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),s("p",[t._v("SQL Mode 还可以实现对数据效验和转移等功能如：")]),t._v(" "),s("ul",[s("li",[t._v("校验日期数据合法性.")]),t._v(" "),s("li",[t._v("在INSERT或UPDATE过程中，如果被零除(或MOD(X，0))，则产生错误")]),t._v(" "),s("li",[t._v('将‘"’视为识别符引号(‘`’引号字符)')]),t._v(" "),s("li",[t._v("禁用反斜线字符(‘\\’)做为字符串内的退出字符。启用NO_BACKSLASH_ESCAPES模式，反斜线则成为普通字符。")]),t._v(" "),s("li",[t._v("将||视为字符串连接操作符（＋）(同CONCAT())，而不视为OR。")])]),t._v(" "),s("h2",{attrs:{id:"修改值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改值"}},[t._v("#")]),t._v(" 修改值")]),t._v(" "),s("p",[t._v("使用命令 "),s("code",[t._v("select @@sql_mode;")]),t._v(" 可以查看sql_mode的值.")]),t._v(" "),s("p",[t._v("在命令行中输入")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("sql_mode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select replace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("@@sql_mode,"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NO_ZERO_IN_DATE,NO_ZERO_DATE'")]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])])]),s("p",[t._v("可以修改sql_mode。")]),t._v(" "),s("p",[t._v("使用命令")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" @@global.sql_mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])])]),s("p",[t._v("可以查看全局sql_mode的值。\n输入以下命令")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v("  @@global.sql_mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select replace"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("@@sql_mode,"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NO_ZERO_IN_DATE,NO_ZERO_DATE'")]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])])]),s("p",[t._v("修改全局的值。")]),t._v(" "),s("p",[t._v("还可以通过在配置文件中进行设置(推荐)")]),t._v(" "),s("p",[t._v("在/etc/my.cnf的[mysqld]下设置")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysqld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nsql_mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("STRICT_TRANS_TABLES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("NO_AUTO_CREATE_USER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("NO_ENGINE_SUBSTITUTION\n")])])]),s("h2",{attrs:{id:"常见的sql-mode值的介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见的sql-mode值的介绍"}},[t._v("#")]),t._v(" 常见的sql_mode值的介绍")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("取值")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("ONLY_FULL_GROUP_BY")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("对于GROUP BY聚合操作，如果在SELECT中的列，没有在GROUP BY中出现，那么将认为这个SQL是不合法的，因为列不在GROUP BY从句中")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("STRICT_TRANS_TABLES")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("在该模式下，如果一个值不能插入到一个事务表中，则中断当前的操作，对非事务表不做任何限制")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("NO_ZERO_IN_DATE")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("在严格模式，不接受月或日部分为0的日期。如果使用IGNORE选项，我们为类似的日期插入'0000-00-00'。在非严格模式，可以接受该日期，但会生成警告。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("NO_ZERO_DATE")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("在严格模式，不要将 '0000-00-00'做为合法日期。你仍然可以用IGNORE选项插入零日期。在非严格模式，可以接受该日期，但会生成警告")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("ERROR_FOR_DIVISION_BY_ZERO")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("在严格模式，在INSERT或UPDATE过程中，如果被零除(或MOD(X，0))，则产生错误(否则为警告)。如果未给出该模式，被零除时MySQL返回NULL。如果用到INSERT IGNORE或UPDATE IGNORE中，MySQL生成被零除警告，但操作结果为NULL。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("NO_AUTO_CREATE_USER")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("防止GRANT自动创建新用户，除非还指定了密码。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("NO_ENGINE_SUBSTITUTION")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("如果需要的存储引擎被禁用或未编译，那么抛出错误。不设置此值时，用默认的存储引擎替代，并抛出一个异常。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("NO_AUTO_VALUE_ON_ZERO")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("该值影响自增长列的插入。默认设置下，插入0或NULL代表生成下一个自增长值。如果用户希望插入的值为0，而该列又是自增长的，那么这个选项就有用了。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("STRICT_TRANS_TABLES")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("在该模式下，如果一个值不能插入到一个事务表中，则中断当前的操作，对非事务表不做限制")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("NO_ZERO_IN_DATE")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("这个模式影响了是否允许日期中的月份和日包含0。如果开启此模式，2016-01-00是不允许的，但是0000-02-01是允许的。它实际的行为受到 strict mode是否开启的影响。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("NO_ZERO_DATE")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("设置该值，mysql数据库不允许插入零日期。它实际的行为受到 strictmode是否开启的影响。")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("ERROR_FOR_DIVISION_BY_ZERO")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("在INSERT或UPDATE过程中，如果数据被零除，则产生错误而非警告。如果未给出该模式，那么数据被零除时MySQL返回NULL")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("NO_AUTO_CREATE_USER")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("禁止GRANT创建密码为空的用户")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("NO_ENGINE_SUBSTITUTION")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("如果需要的存储引擎被禁用或未编译，那么抛出错误。不设置此值时，用默认的存储引擎替代，并抛出一个异常")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("PIPES_AS_CONCAT")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("将”")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("ANSI_QUOTES")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("启用ANSI_QUOTES后，不能用双引号来引用字符串，因为它被解释为识别符")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("在生产环境下设置为\nsql_mode='NO_ENGINE_SUBSTITUTION,NO_AUTO_CREATE_USER'\n可以减少较少的错误")])]),t._v(" "),s("p",[s("strong",[t._v("注意")]),t._v("：")]),t._v(" "),s("p",[t._v("MySQL8以上已经取消了NO_AUTO_CREATE_USER，故将sql_mode修改为如下即可：")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sql")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mode")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NO_ENGINE_SUBSTITUTION\n")])])])])}),[],!1,null,null,null);e.default=_.exports}}]);