(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{601:function(s,a,t){"use strict";t.r(a);var e=t(13),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mysql开启审计功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql开启审计功能"}},[s._v("#")]),s._v(" MySQL开启审计功能")]),s._v(" "),t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),t("p",[s._v("其实mysql本身已经提供了详细的sql执行记录–general log ，但是开启它有以下几个缺点")]),s._v(" "),t("p",[s._v("无论sql有无语法错误，只要执行了就会记录，导致记录大量无用信息，后期的筛选有难度。")]),s._v(" "),t("p",[s._v("sql并发量很大时，log的记录会对io造成一定的印象，是数据库效率降低。")]),s._v(" "),t("p",[s._v("日志文件很容易快速膨胀，不妥善处理会对磁盘空间造成一定影响。")]),s._v(" "),t("h2",{attrs:{id:"查询审计配置情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询审计配置情况"}},[s._v("#")]),s._v(" 查询审计配置情况")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'log_timestamps'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%general%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"永久开启审计功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#永久开启审计功能"}},[s._v("#")]),s._v(" 永久开启审计功能")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/my.cnf\n\n在/etc/my.cnf中添加下述配置\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\ngeneral_log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" on                                   // on为开启；off为关闭\n\ngeneral_log_file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/log/generalLog.log         // 审计信息存储位置\n\nlog_timestamps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SYSTEM                            // 设置日志文件的输出时间为地方时\n")])])]),t("h2",{attrs:{id:"临时开启审计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#临时开启审计"}},[s._v("#")]),s._v(" 临时开启审计")]),s._v(" "),t("p",[s._v("在mysql中执行以下命令:")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" general_log "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" general_log_file "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("generalLog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" log_timestamps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SYSTEM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);